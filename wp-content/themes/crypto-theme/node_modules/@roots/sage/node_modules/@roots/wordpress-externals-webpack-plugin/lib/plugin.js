import { window } from '@roots/wordpress-transforms';
import Webpack, {} from 'webpack';
/**
 * {@link WebpackPluginInstance}
 */
export class WordPressExternalsWebpackPlugin {
    options;
    /**
     * Class constructor
     */
    constructor(options) {
        this.options = options;
    }
    /**
     * {@link WebpackPluginInstance.apply}
     */
    apply(compiler) {
        new Webpack.ExternalsPlugin(`window`, ({ request }, callback) => {
            // evidently this can be undefined? OK.
            if (!request)
                return callback();
            // bail on excluded signifiers
            if (this.options?.exclude?.includes(request))
                return callback();
            const lookup = window.transform(request);
            return lookup ? callback(null, lookup) : callback();
        }).apply(compiler);
    }
}
